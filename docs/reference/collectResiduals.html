<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Residual hooks and collection methods — collectResiduals • MAST</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Residual hooks and collection methods — collectResiduals" />

<meta property="og:description" content="After each gene is fit, a hook function can optionally be run and the output saved.
This allows extended computations to be done using the fitted model, without keeping it in memory.
Here this is used to calculate various residuals, though in some cases they can be done using only the information contained in the ZlmFit-class." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MAST</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">1.7.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/MAITAnalysis.html">Using MAST with RNASeq: MAIT Analysis.</a>
    </li>
    <li>
      <a href="../articles/MAST-Intro.html">MAST Intro</a>
    </li>
    <li>
      <a href="../articles/MAST-interoperability.html">Interoptability between MAST and SingleCellExperiment-derived packages.</a>
    </li>
  </ul>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/RGLab/MAST/">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Residual hooks and collection methods</h1>
    <small class="dont-index">Source: <a href='https://github.com/RGLab/MAST//blob/master/R/zlmHooks.R'><code>R/zlmHooks.R</code></a></small>
    <div class="hidden name"><code>collectResiduals.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>After each gene is fit, a hook function can optionally be run and the output saved.
This allows extended computations to be done using the fitted model, without keeping it in memory.
Here this is used to calculate various residuals, though in some cases they can be done using only the information contained in the <code>ZlmFit</code>-class.</p>
    
    </div>

    <pre class="usage"><span class='fu'>collectResiduals</span>(<span class='no'>x</span>, <span class='no'>sca</span>, <span class='kw'>newLayerName</span> <span class='kw'>=</span> <span class='st'>"Residuals"</span>)

<span class='fu'>discrete_residuals_hook</span>(<span class='no'>x</span>)

<span class='fu'>continuous_residuals_hook</span>(<span class='no'>x</span>)

<span class='fu'>combined_residuals_hook</span>(<span class='no'>x</span>)

<span class='fu'>deviance_residuals_hook</span>(<span class='no'>x</span>)

<span class='fu'>fitted_phat</span>(<span class='no'>x</span>)

<span class='fu'>partialScore</span>(<span class='no'>x</span>, <span class='no'>effectRegex</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p><code>ZlmFit</code>-class</p></td>
    </tr>
    <tr>
      <th>sca</th>
      <td><p><code>SingleCellAssay</code> object to which the residuals should be added</p></td>
    </tr>
    <tr>
      <th>newLayerName</th>
      <td><p><code>character</code> name of the assay layer</p></td>
    </tr>
    <tr>
      <th>effectRegex</th>
      <td><p>a regular expression naming columns of the design corresponding to \(Z_0\).
Generally these should be the treatment effects of interest.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>copy of <code>sca</code> with new layer</p>
    
    <h2 class="hasAnchor" id="functions"><a class="anchor" href="#functions"></a>Functions</h2>

    <ul>
<li><p><code>discrete_residuals_hook</code>: Hook to get the discrete residuals, ie, difference between expected probability of expression and observed</p></li>
<li><p><code>continuous_residuals_hook</code>: Hook to get the continuous residuals, ie, residuals for conditionally positive observations.  If an observation is zero, it's residual is defined to be zero as well.</p></li>
<li><p><code>combined_residuals_hook</code>: Hook to get the combined residuals, ie, Y-E(U)*E(V)</p></li>
<li><p><code>deviance_residuals_hook</code>: Standardized deviance residuals hook. Computes the sum of the standardized deviance residuals for the discrete and continuous models (scaled to have unit variance).  If the observation is zero then only the discrete component is used.</p></li>
<li><p><code>fitted_phat</code>: Hook to return p_hat, the predicted probability of expression.</p></li>
<li><p><code>partialScore</code>: Compute \(Y_i-E(V_i|X_i, Z_0)E(U|X_i, Z_0)\), where \(Z_0\) is a  treatment effect (being left in) and \(X_i\) is a nuisance effect (being regressed out).</p></li>
</ul>
    
    <h2 class="hasAnchor" id="total-residual-types"><a class="anchor" href="#total-residual-types"></a>Total residual types</h2>

    
    <p>Each component of the model contributes several flavors of residual, which can be combined in various fashions.
The discrete residual can be on the response scale (thus subtracting the predicted probability of expression from the 0/1 expression value).
Or it can be a deviance residual, revealing something about the log-likelihood.</p>
    
    <h2 class="hasAnchor" id="partial-residuals"><a class="anchor" href="#partial-residuals"></a>Partial residuals</h2>

    
    <p>It's also possible to consider partial residuals, in which the contribution of a particular covariate is added back into the model.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>zlm</p></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'>data</span>(<span class='no'>vbetaFA</span>)
<span class='no'>svbeta</span> <span class='kw'>&lt;-</span> <span class='fu'>subset</span>(<span class='no'>vbetaFA</span>, <span class='no'>ncells</span><span class='kw'>==</span><span class='fl'>1</span>)
<span class='no'>svbeta</span> <span class='kw'>&lt;-</span> <span class='no'>svbeta</span>[<span class='fu'><a href='freq.html'>freq</a></span>(<span class='no'>svbeta</span>)<span class='kw'>&gt;</span><span class='fl'>.4</span>,]
<span class='no'>window</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>x1</span>) <span class='fu'>lapply</span>(<span class='fu'>assays</span>(<span class='no'>x1</span>), <span class='kw'>function</span>(<span class='no'>x2</span>) <span class='no'>x2</span>[<span class='fl'>1</span>:<span class='fl'>3</span>, <span class='fl'>1</span>:<span class='fl'>6</span>])
<span class='co'>#total residuals of the response</span>
<span class='no'>z1</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='zlm.html'>zlm</a></span>(~ <span class='no'>Stim.Condition</span>, <span class='no'>svbeta</span>, <span class='kw'>hook</span><span class='kw'>=</span><span class='no'>discrete_residuals_hook</span>)</div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>Done!</span></div><div class='input'><span class='fu'>window</span>(<span class='fu'>collectResiduals</span>(<span class='no'>z1</span>, <span class='no'>svbeta</span>))</div><div class='output co'>#&gt; $Et
#&gt;         wellKey
#&gt; primerid Sub01 1 A01 Sub01 1 A02 Sub01 1 A03 Sub01 1 A04 Sub01 1 A05
#&gt;     CCR7     0.00000    18.32835    18.72408     0.00000     0.00000
#&gt;     CD28    14.36047     0.00000    16.50232    15.36025    13.85367
#&gt;     CD3d    14.39789    15.71954    17.08992    16.37704    17.38282
#&gt;         wellKey
#&gt; primerid Sub01 1 A06
#&gt;     CCR7     0.00000
#&gt;     CD28     0.00000
#&gt;     CD3d    15.54438
#&gt; 
#&gt; $Residuals
#&gt;      Sub01 1 A01 Sub01 1 A02 Sub01 1 A03 Sub01 1 A04 Sub01 1 A05 Sub01 1 A06
#&gt; CCR7  -0.5009035   0.4990965   0.4990965  -0.5009035  -0.5009035  -0.5009035
#&gt; CD28   0.4962616  -0.5037384   0.4962616   0.4962616   0.4962616  -0.5037384
#&gt; CD3d   0.3473145   0.3473145   0.3473145   0.3473145   0.3473145   0.3473145
#&gt; </div><div class='input'><span class='no'>z2</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='zlm.html'>zlm</a></span>(~ <span class='no'>Stim.Condition</span>, <span class='no'>svbeta</span>, <span class='kw'>hook</span><span class='kw'>=</span><span class='no'>continuous_residuals_hook</span>)</div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>Done!</span></div><div class='input'><span class='fu'>window</span>(<span class='fu'>collectResiduals</span>(<span class='no'>z2</span>, <span class='no'>svbeta</span>))</div><div class='output co'>#&gt; $Et
#&gt;         wellKey
#&gt; primerid Sub01 1 A01 Sub01 1 A02 Sub01 1 A03 Sub01 1 A04 Sub01 1 A05
#&gt;     CCR7     0.00000    18.32835    18.72408     0.00000     0.00000
#&gt;     CD28    14.36047     0.00000    16.50232    15.36025    13.85367
#&gt;     CD3d    14.39789    15.71954    17.08992    16.37704    17.38282
#&gt;         wellKey
#&gt; primerid Sub01 1 A06
#&gt;     CCR7     0.00000
#&gt;     CD28     0.00000
#&gt;     CD3d    15.54438
#&gt; 
#&gt; $Residuals
#&gt;      Sub01 1 A01 Sub01 1 A02 Sub01 1 A03 Sub01 1 A04 Sub01 1 A05 Sub01 1 A06
#&gt; CCR7    0.000000   0.1679555   0.5636873   0.0000000   0.0000000    0.000000
#&gt; CD28   -1.338277   0.0000000   0.8035785  -0.3384889  -1.8450766    0.000000
#&gt; CD3d   -2.235474  -0.9138159   0.4565626  -0.2563244   0.7494639   -1.088981
#&gt; </div><div class='input'><span class='no'>z3</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='zlm.html'>zlm</a></span>(~ <span class='no'>Stim.Condition</span>, <span class='no'>svbeta</span>, <span class='kw'>hook</span><span class='kw'>=</span><span class='no'>combined_residuals_hook</span>)</div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>Done!</span></div><div class='input'><span class='fu'>window</span>(<span class='fu'>collectResiduals</span>(<span class='no'>z3</span>, <span class='no'>svbeta</span>))</div><div class='output co'>#&gt; $Et
#&gt;         wellKey
#&gt; primerid Sub01 1 A01 Sub01 1 A02 Sub01 1 A03 Sub01 1 A04 Sub01 1 A05
#&gt;     CCR7     0.00000    18.32835    18.72408     0.00000     0.00000
#&gt;     CD28    14.36047     0.00000    16.50232    15.36025    13.85367
#&gt;     CD3d    14.39789    15.71954    17.08992    16.37704    17.38282
#&gt;         wellKey
#&gt; primerid Sub01 1 A06
#&gt;     CCR7     0.00000
#&gt;     CD28     0.00000
#&gt;     CD3d    15.54438
#&gt; 
#&gt; $Residuals
#&gt;      Sub01 1 A01 Sub01 1 A02 Sub01 1 A03 Sub01 1 A04 Sub01 1 A05 Sub01 1 A06
#&gt; CCR7   -9.096604    9.231742    9.627474   -9.096604   -9.096604   -9.096604
#&gt; CD28    6.452407   -7.908060    8.594263    7.452195    5.945608   -7.908060
#&gt; CD3d    3.541534    4.863192    6.233570    5.520683    6.526472    4.688027
#&gt; </div><div class='input'><span class='co'>#total deviance residuals</span>
<span class='no'>z4</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='zlm.html'>zlm</a></span>(~ <span class='no'>Stim.Condition</span>, <span class='no'>svbeta</span>, <span class='kw'>hook</span><span class='kw'>=</span><span class='no'>deviance_residuals_hook</span>)</div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>Done!</span></div><div class='input'><span class='fu'>window</span>(<span class='fu'>collectResiduals</span>(<span class='no'>z4</span>, <span class='no'>svbeta</span>))</div><div class='output co'>#&gt; $Et
#&gt;         wellKey
#&gt; primerid Sub01 1 A01 Sub01 1 A02 Sub01 1 A03 Sub01 1 A04 Sub01 1 A05
#&gt;     CCR7     0.00000    18.32835    18.72408     0.00000     0.00000
#&gt;     CD28    14.36047     0.00000    16.50232    15.36025    13.85367
#&gt;     CD3d    14.39789    15.71954    17.08992    16.37704    17.38282
#&gt;         wellKey
#&gt; primerid Sub01 1 A06
#&gt;     CCR7     0.00000
#&gt;     CD28     0.00000
#&gt;     CD3d    15.54438
#&gt; 
#&gt; $Residuals
#&gt;        Sub01 1 A01 Sub01 1 A02 Sub01 1 A03 Sub01 1 A04 Sub01 1 A05 Sub01 1 A06
#&gt; CCR7 -1.1807421280   0.9140304   1.1055706  -1.1807429  -1.1807429  -1.1807429
#&gt; CD28  0.0005025943  -1.1855719   1.3270080   0.6196969  -0.3133707  -1.1855719
#&gt; CD3d -0.4707941596   0.1943183   0.8839489   0.5251950   1.0313488   0.1061683
#&gt; </div><div class='input'><span class='co'>#partial residuals</span>
<span class='fu'>colData</span>(<span class='no'>svbeta</span>)$<span class='no'>ngeneson</span> <span class='kw'>&lt;-</span> <span class='fu'>colMeans</span>(<span class='fu'>assay</span>(<span class='no'>svbeta</span>)<span class='kw'>&gt;</span><span class='fl'>0</span>)
<span class='no'>z5</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='zlm.html'>zlm</a></span>(~ <span class='no'>Stim.Condition</span> + <span class='no'>ngeneson</span>, <span class='no'>svbeta</span>)</div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>Done!</span></div><div class='input'><span class='fu'>partialScore</span>(<span class='no'>z5</span>, <span class='st'>'Stim.Condition'</span>)</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#functions">Functions</a></li>

      <li><a href="#total-residual-types">Total residual types</a></li>

      <li><a href="#partial-residuals">Partial residuals</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Andrew McDavid, Greg Finak, Masanao Yajima.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>


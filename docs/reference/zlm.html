<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Zero-inflated regression for SingleCellAssay — zlm • MAST</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Zero-inflated regression for SingleCellAssay — zlm" />

<meta property="og:description" content="For each gene in sca, fits the hurdle model in formula (linear for et&amp;gt;0), logistic for et==0 vs et&amp;gt;0.
Return an object of class ZlmFit containing slots giving the coefficients, variance-covariance matrices, etc.
After each gene, optionally run the function on the fit named by 'hook'" />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MAST</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">1.7.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/MAITAnalysis.html">Using MAST with RNASeq: MAIT Analysis.</a>
    </li>
    <li>
      <a href="../articles/MAST-Intro.html">MAST Intro</a>
    </li>
    <li>
      <a href="../articles/MAST-interoperability.html">Interoptability between MAST and SingleCellExperiment-derived packages.</a>
    </li>
  </ul>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/RGLab/MAST/">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Zero-inflated regression for SingleCellAssay</h1>
    <small class="dont-index">Source: <a href='https://github.com/RGLab/MAST//blob/master/R/zeroinf.R'><code>R/zeroinf.R</code></a></small>
    <div class="hidden name"><code>zlm.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>For each gene in sca, fits the hurdle model in <code>formula</code> (linear for et&gt;0), logistic for et==0 vs et&gt;0.
Return an object of class <code>ZlmFit</code> containing slots giving the coefficients, variance-covariance matrices, etc.
After each gene, optionally run the function on the fit named by 'hook'</p>
    
    </div>

    <pre class="usage"><span class='fu'>zlm</span>(<span class='no'>formula</span>, <span class='no'>sca</span>, <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"bayesglm"</span>, <span class='kw'>silent</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>ebayes</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>ebayesControl</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>force</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>hook</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>parallel</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='no'>LMlike</span>, <span class='kw'>onlyCoef</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='no'>...</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>formula</th>
      <td><p>a formula with the measurement variable on the LHS and predictors present in colData on the RHS</p></td>
    </tr>
    <tr>
      <th>sca</th>
      <td><p>SingleCellAssay object</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>character vector, either 'glm', 'glmer' or 'bayesglm'</p></td>
    </tr>
    <tr>
      <th>silent</th>
      <td><p>Silence common problems with fitting some genes</p></td>
    </tr>
    <tr>
      <th>ebayes</th>
      <td><p>if TRUE, regularize variance using empirical bayes method</p></td>
    </tr>
    <tr>
      <th>ebayesControl</th>
      <td><p>list with parameters for empirical bayes procedure.  See <a href='ebayes.html'>ebayes</a>.</p></td>
    </tr>
    <tr>
      <th>force</th>
      <td><p>Should we continue testing genes even after many errors have occurred?</p></td>
    </tr>
    <tr>
      <th>hook</th>
      <td><p>a function called on the <code>fit</code> after each gene.</p></td>
    </tr>
    <tr>
      <th>parallel</th>
      <td><p>If TRUE and <code>option(mc.cores)&gt;1</code> then multiple cores will be used in fitting.</p></td>
    </tr>
    <tr>
      <th>LMlike</th>
      <td><p>if provided, then the model defined in this object will be used, rather than following the formulas.  This is intended for internal use.</p></td>
    </tr>
    <tr>
      <th>onlyCoef</th>
      <td><p>If TRUE then only an array of model coefficients will be returned (probably only useful for bootstrapping).</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>arguments passed to the S4 model object upon construction.  For example, <code>fitArgsC</code> and <code>fitArgsD</code>, or <code>coefPrior</code>.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>a object of class <code>ZlmFit</code> with methods to extract coefficients, etc. 
OR, if data is a <code>data.frame</code> just a list of the discrete and continuous fits.</p>
    
    <h2 class="hasAnchor" id="empirical-bayes-variance-regularization"><a class="anchor" href="#empirical-bayes-variance-regularization"></a>Empirical Bayes variance regularization</h2>

    
    <p>The empirical bayes regularization of the gene variance assumes that the precision (1/variance) is drawn from a
gamma distribution with unknown parameters.
These parameters are estimated by considering the distribution of sample variances over all genes.
The procedure used for this is determined from
<code>ebayesControl</code>, a named list with components 'method' (one of 'MOM' or 'MLE') and 'model' (one of 'H0' or 'H1')
method MOM uses a method-of-moments estimator, while MLE using the marginal likelihood.
H0 model estimates the precisions using the intercept alone in each gene, while H1 fits the full model specified by <code>formula</code></p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>ZlmFit-class, ebayes, GLMlike-class, BayesGLMlike-class</p></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'>data</span>(<span class='no'>vbetaFA</span>)
<span class='no'>zlmVbeta</span> <span class='kw'>&lt;-</span> <span class='fu'>zlm</span>(~ <span class='no'>Stim.Condition</span>, <span class='fu'>subset</span>(<span class='no'>vbetaFA</span>, <span class='no'>ncells</span><span class='kw'>==</span><span class='fl'>1</span>)[<span class='fl'>1</span>:<span class='fl'>10</span>,])</div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>Done!</span></div><div class='input'><span class='fu'>slotNames</span>(<span class='no'>zlmVbeta</span>)</div><div class='output co'>#&gt;  [1] "coefC"              "coefD"              "vcovC"             
#&gt;  [4] "vcovD"              "LMlike"             "sca"               
#&gt;  [7] "deviance"           "loglik"             "df.null"           
#&gt; [10] "df.resid"           "dispersion"         "dispersionNoshrink"
#&gt; [13] "priorDOF"           "priorVar"           "converged"         
#&gt; [16] "hookOut"           </div><div class='input'><span class='co'>#A matrix of coefficients</span>
<span class='fu'>coef</span>(<span class='no'>zlmVbeta</span>, <span class='st'>'D'</span>)[<span class='st'>'CCL2'</span>,]</div><div class='output co'>#&gt;          (Intercept) Stim.ConditionUnstim 
#&gt;           -3.8329217           -0.5108005 </div><div class='input'><span class='co'>#An array of covariance matrices</span>
<span class='fu'>vcov</span>(<span class='no'>zlmVbeta</span>, <span class='st'>'D'</span>)[,,<span class='st'>'CCL2'</span>]</div><div class='output co'>#&gt;                      (Intercept) Stim.ConditionUnstim
#&gt; (Intercept)            0.1439196           -0.1254838
#&gt; Stim.ConditionUnstim  -0.1254838            0.9182853</div><div class='input'><span class='fu'><a href='waldTest.html'>waldTest</a></span>(<span class='no'>zlmVbeta</span>, <span class='fu'><a href='Hypothesis.html'>CoefficientHypothesis</a></span>(<span class='st'>'Stim.ConditionUnstim'</span>))</div><div class='output co'>#&gt; , , metric = lambda
#&gt; 
#&gt;         test.type
#&gt; primerid         cont        disc    hurdle
#&gt;   B3GAT1 0.9617702324 0.038250068  1.000020
#&gt;   BAX    7.2211565188 3.645901878 10.867058
#&gt;   BCL2   0.3766814067 2.202291748  2.578973
#&gt;   CCL2   0.8414775522 0.284135226  1.125613
#&gt;   CCL3             NA 3.548463195        NA
#&gt;   CCL4             NA 2.012308210        NA
#&gt;   CCL5   0.1746468538 0.862093478  1.036740
#&gt;   CCR2   5.3383734489 2.308408187  7.646782
#&gt;   CCR4   2.0437612666 0.003737042  2.047498
#&gt;   CCR5   0.0005534473 2.811952306  2.812506
#&gt; 
#&gt; , , metric = df
#&gt; 
#&gt;         test.type
#&gt; primerid cont disc hurdle
#&gt;   B3GAT1    1    1      2
#&gt;   BAX       1    1      2
#&gt;   BCL2      1    1      2
#&gt;   CCL2      1    1      2
#&gt;   CCL3      1    1      2
#&gt;   CCL4      1    1      2
#&gt;   CCL5      1    1      2
#&gt;   CCR2      1    1      2
#&gt;   CCR4      1    1      2
#&gt;   CCR5      1    1      2
#&gt; 
#&gt; , , metric = Pr(&gt;Chisq)
#&gt; 
#&gt;         test.type
#&gt; primerid        cont       disc      hurdle
#&gt;   B3GAT1 0.326741272 0.84494185 0.606524503
#&gt;   BAX    0.007204927 0.05620735 0.004367654
#&gt;   BCL2   0.539384664 0.13780573 0.275412150
#&gt;   CCL2   0.358974532 0.59400356 0.569608276
#&gt;   CCL3            NA 0.05960063          NA
#&gt;   CCL4            NA 0.15602777          NA
#&gt;   CCL5   0.676014596 0.35315351 0.595490308
#&gt;   CCR2   0.020860929 0.12867576 0.021853574
#&gt;   CCR4   0.152831343 0.95125460 0.359245545
#&gt;   CCR5   0.981231129 0.09356445 0.245059834
#&gt; </div><div class='input'>
<span class='co'>## Can also provide just a \code{data.frame} instead</span>
<span class='no'>data</span><span class='kw'>&lt;-</span> <span class='fu'>data.frame</span>(<span class='kw'>x</span><span class='kw'>=</span><span class='fu'>rnorm</span>(<span class='fl'>500</span>), <span class='kw'>z</span><span class='kw'>=</span><span class='fu'>rbinom</span>(<span class='fl'>500</span>, <span class='fl'>1</span>, <span class='fl'>.3</span>))
<span class='no'>logit.y</span> <span class='kw'>&lt;-</span> <span class='fu'>with</span>(<span class='no'>data</span>, <span class='no'>x</span>*<span class='fl'>2</span> + <span class='no'>z</span>*<span class='fl'>2</span>); <span class='no'>mu.y</span> <span class='kw'>&lt;-</span> <span class='fu'>with</span>(<span class='no'>data</span>, <span class='fl'>10</span>+<span class='fl'>10</span>*<span class='no'>x</span>+<span class='fl'>10</span>*<span class='no'>z</span> + <span class='fu'>rnorm</span>(<span class='fl'>500</span>))
<span class='no'>y</span> <span class='kw'>&lt;-</span> (<span class='fu'>runif</span>(<span class='fl'>500</span>)<span class='kw'>&lt;</span><span class='fu'>exp</span>(<span class='no'>logit.y</span>)/(<span class='fl'>1</span>+<span class='fu'>exp</span>(<span class='no'>logit.y</span>)))*<span class='fl'>1</span>
<span class='no'>y</span>[<span class='no'>y</span><span class='kw'>&gt;</span><span class='fl'>0</span>] <span class='kw'>&lt;-</span> <span class='no'>mu.y</span>[<span class='no'>y</span><span class='kw'>&gt;</span><span class='fl'>0</span>]
<span class='no'>data</span>$<span class='no'>y</span> <span class='kw'>&lt;-</span> <span class='no'>y</span>
<span class='no'>fit</span> <span class='kw'>&lt;-</span> <span class='fu'>zlm</span>(<span class='no'>y</span> ~ <span class='no'>x</span>+<span class='no'>z</span>, <span class='no'>data</span>)
<span class='fu'>summary.glm</span>(<span class='no'>fit</span>$<span class='no'>disc</span>)</div><div class='output co'>#&gt; 
#&gt; Call:
#&gt; NULL
#&gt; 
#&gt; Deviance Residuals: 
#&gt;     Min       1Q   Median       3Q      Max  
#&gt; -60.165   -1.166    1.019    1.175   10.305  
#&gt; 
#&gt; Coefficients:
#&gt;             Estimate Std. Error z value Pr(&gt;|z|)    
#&gt; (Intercept)  -0.1700     0.1463  -1.162    0.245    
#&gt; x             2.4832     0.2276  10.911  &lt; 2e-16 ***
#&gt; z             2.6332     0.3376   7.800  6.2e-15 ***
#&gt; ---
#&gt; Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
#&gt; 
#&gt; (Dispersion parameter for binomial family taken to be 1)
#&gt; 
#&gt;     Null deviance: 671.36  on 499  degrees of freedom
#&gt; Residual deviance: 372.26  on 195  degrees of freedom
#&gt; AIC: 378.26
#&gt; 
#&gt; Number of Fisher Scoring iterations: 6
#&gt; </div><div class='input'><span class='fu'>summary.glm</span>(<span class='no'>fit</span>$<span class='no'>cont</span>)</div><div class='output co'>#&gt; 
#&gt; Call:
#&gt; NULL
#&gt; 
#&gt; Deviance Residuals: 
#&gt;      Min        1Q    Median        3Q       Max  
#&gt; -2.93103  -0.66362   0.00543   0.72475   3.12330  
#&gt; 
#&gt; Coefficients:
#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    
#&gt; (Intercept)  9.98163    0.09703  102.87   &lt;2e-16 ***
#&gt; x            9.98076    0.08343  119.63   &lt;2e-16 ***
#&gt; z           10.11319    0.12710   79.57   &lt;2e-16 ***
#&gt; ---
#&gt; Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
#&gt; 
#&gt; (Dispersion parameter for gaussian family taken to be 1.07014)
#&gt; 
#&gt;     Null deviance: 17942.40  on 301  degrees of freedom
#&gt; Residual deviance:   319.97  on 299  degrees of freedom
#&gt; AIC: 882.5
#&gt; 
#&gt; Number of Fisher Scoring iterations: 2
#&gt; </div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#empirical-bayes-variance-regularization">Empirical Bayes variance regularization</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Andrew McDavid, Greg Finak, Masanao Yajima.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

